---
title: "p8105_hw2_fl2715"
author: "Fengwei Lei"
output: github_document
---

## Load Necessary Library
```{r load_libraries}
library(tidyverse)
library(readxl)
```

## Problem 1

```{r}
nyc_df=
  read_csv(
    "./NYC_Transit_Subway_Entrance_And_Exit_Data.csv",
    na = c("NA", ".", "")) |> 
  janitor::clean_names() |> 
  select(
    line, station_name, station_latitude, station_longitude, 
    starts_with("route"), entry, exit_only, vending, entrance_type, 
    ada) |> 
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))
```

The above dataset contains information from `NYC_Transit_Subway_Entrance_And_Exit_Data.csv`. It includes variables such as subway line, station name, latitude, longitude, routes served, entry status, exit-only status, vending availability, entrance type, and ADA compliance. Data cleaning steps involved handling missing values, cleaning column names, selecting relevant variables, and converting the entry variable from “YES”/“NO” to a logical format (TRUE/FALSE). The resulting dataset has `r nrow(nyc_df)` rows and `r ncol(nyc_df)` columns.

But these data is not fully “tidy”: both the route number and route should be treated as variables. To make the dataset tidy, we need to reshape the route variables from wide to long format. This restructuring is helpful when analyzing specific routes.

The below code shows that the number of distinct stations identified both by name and line, where we use the `distinct()` fuction.

```{r}
nyc_df |> 
  select(station_name, line) |> 
  distinct()
```

The following code chunk illustrates the number of stations which are ADA compliant. Firstly, we filter the rows where `ada == TRUE`. And we do the similar steps to the above code chunk.

```{r}
nyc_df |> 
  filter(ada == TRUE) |> 
  select(station_name, line) |> 
  distinct()
```

The following code chunk shows the proportion of station entrances / exits without vending allow entrance. We firstly filter the rows where there is no vending. And since the variable `entry` is a logical variable, we could compute the mean for calculating proportion.

```{r}
nyc_df |> 
  filter(vending == "NO") |> 
  pull(entry) |> 
  mean()
```

Finally, we compute the number of distinct stations that serve the A train, and that are ADA compliant. To reformat the data successfully, we firstly convert the variables `route8`, `route9`, `route10` and `route11` into character type, since they were double type before. After that, we tidy the data with converting `route` from wide to long format. And then, we use `filter()`, `select()`, `distinct()` function to find the regarding results (similar to the above steps).
```{r}
nyc_df=
  nyc_df |> 
  mutate(
    route8=as.character(route8),
    route9=as.character(route9),
    route10=as.character(route10),
    route11=as.character(route11))

nyc_df |> 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") |> 
  filter(route == "A") |> 
  select(station_name, line) |> 
  distinct()

nyc_df |> 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") |> 
  filter(route == "A", ada == TRUE) |> 
  select(station_name, line) |> 
  distinct()
```

From the above reformat data, we can see that there are **60** distinct stations serve the A train. And **17** Of the stations that serve the A train and are ADA compliant.

## Problem 2

### Read and Clean Mr. Trash Wheel Data

The following code block reads the Mr. Trash Wheel sheet from the Excel file, starting from the second row to skip the header. We use `janitor::clean_names()` to clean the column names. Then, we apply `filter()` to remove rows with missing values in the dumpster column, retaining only those that contain specific dumpster data. Next, we use `mutate()` to round the values in the sports_balls column to the nearest integer and convert them to integer type while adding a source column to indicate that the data comes from “Mr.”

```{r}
mr_trash_wheel=
  read_excel(
    "./202409 Trash Wheel Collection Data.xlsx",
    sheet="Mr. Trash Wheel",
    range="A2:N655") |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    sports_balls = as.integer(round(sports_balls)),
    source="Mr"
  )

mr_trash_wheel
```

